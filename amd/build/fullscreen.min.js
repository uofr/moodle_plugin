function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}define("mod_kalvidassign/fullscreen",["jquery","core/templates","core/ajax","core/notification","core/str"],(function($,Templates,ajax,notification,Str){var MEDIABOX=function(allowcomments,allowlikes){var vars__navbarheight=60,root=this;this.construct=function(allowcomments,allowlikes){_allowlikes=allowlikes,_allowcomments=allowcomments,enable(),build()};var _ref,_ref2,_ref3,_ref4,build=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var data,template,i,navitem,item;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return data={allowlikes:_allowlikes,allowcomments:_allowcomments},_context.next=3,render("mod_kalvidassign/sidebar",data);case 3:for(template=_context.sent,$("body").append(template),root.overlay=$("#mediabox-overlay"),root.mediabox=$("#mediabox"),root.navbar=$("#mediabox-navbar"),resizeoverlay(),root.album=$(".kalvidassign_videocards"),root.overlay.bind("click",(function(){stop()})),$("#mediabox","#mediabox-navbar, #mediabox-navbar-container").click((function(){if("mediabox-navbar-container"===e.currentTarget.get("id"))return!1;stop()})),$(window).scroll((function(){enable()})),$(window).resize((function(){resizeoverlay(),repositionitem()})),$(window).width()<400?$("#mediabox").hasClass("sidebarhidden")||($("#mediabox").addClass("sidebarhidden"),$("#sidebar-actions").addClass("mod-kalvidassign-sidebar-shrink"),$("#mediabox-metainfo").addClass("hide"),$("#mediabox-social").addClass("hide"),$("#mediabox-comments").addClass("hide"),$(this).addClass("fa-plus").removeClass("fa-minus"),resizeoverlay(),repositionitem()):$("#mediabox").hasClass("sidebarhidden")&&($("#mediabox").removeClass("sidebarhidden"),$("#sidebar-actions").removeClass("mod-kalvidassign-sidebar-shrink"),$("#mediabox-metainfo").removeClass("hide"),$("#mediabox-social").removeClass("hide"),$("#mediabox-comments").removeClass("hide"),$(this).addClass("fa-minus").removeClass("fa-minus"),resizeoverlay(),repositionitem()),$("#sidebar-actions .sidebartoggle").click((function(){$("#mediabox").toggleClass("sidebarhidden"),$("#sidebar-actions").toggleClass("mod-kalvidassign-sidebar-shrink"),$("#mediabox-metainfo").toggleClass("hide"),$("#mediabox-social").toggleClass("hide"),$("#mediabox-comments").toggleClass("hide"),$(this).hasClass("fa-minus")?$(this).addClass("fa-plus").removeClass("fa-minus"):$(this).addClass("fa-minus").removeClass("fa-plus"),resizeoverlay(),repositionitem()})),i=0;i<root.album.length;i++)(navitem=Y.Node.create('<div class="navitem"></div>')).setAttribute("data-id",i),(item=Y.Node.create("<img/>")).setAttribute("src",root.album[i].children[0].getAttribute("src")),item.appendTo(navitem),navitem.appendTo("#mediabox-navbar-container");Y.delegate("click",(function(e){e.preventDefault(),changeitem(e.currentTarget.getAttribute("data-id"))}),"#mediabox-navbar",".navitem"),console.log("likes and comments"),console.log(_allowlikes),console.log(_allowcomments),_allowlikes&&$("#liked").click((function(){if($("#liked").hasClass("fa-heart"))likedbyme=0,$("#liked").removeClass("fa-heart"),$("#liked").addClass("fa-heart-o");else{var likedbyme=1;$("#liked").removeClass("fa-heart-o"),$("#liked").addClass("fa-heart")}var ajaxCall={methodname:"mod_kalvidassign_update_likes",args:{vidid:$(root.currentitem).attr("id"),liked:likedbyme},fail:notification.exception};ajax.call([ajaxCall])[0].done((function(response){response.result&&($hidden=$(root.currentitem).find(".url"),$hidden.data("liked",likedbyme))}))})),$("#mediabox-metainfo a").click((function(){$(this).find("i").hasClass("fa-caret-right")?$(this).find("i").addClass("fa-caret-down").removeClass("fa-caret-right"):$(this).find("i").addClass("fa-caret-right").removeClass("fa-caret-down")})),$("#previous").click((function(){return 0===root.currentitemindex?changeitem(root.album.length-1):changeitem(root.currentitemindex-1),!1})),$("#next").click((function(){return root.currentitemindex===root.album.length-1?changeitem(0):changeitem(root.currentitemindex+1),!1})),$("#sidebar-actions .mbclose").click((function(){return stop(),!1}));case 26:case"end":return _context.stop()}}),_callee,this)}))),function(){return _ref.apply(this,arguments)}),updatenavbarselection=function(itemnumber){var current=root.navbar.one(".navitem.current");current&&current.removeClass("current"),root.navbar.one('.navitem[data-id="'+itemnumber+'"]').addClass("current");var navbar=$("#mediabox-navbar"),currentitem=$("#mediabox-navbar-container .current"),itemwidth=currentitem.get("clientWidth")+2*parseInt(currentitem.css("margin-left"),10),index=$("#mediabox-navbar-container .navitem").index(currentitem),margin=navbar.get("clientWidth")/2-itemwidth/2-index*itemwidth;$("#mediabox-navbar-container").css("margin-left",margin+"px")},changeitem=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(itemnumber){var content,playerinfo,player,creator,title,liked,totallikes,commentid,commentbox,contextid,courseid,data,template;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(root.currentitemindex!==itemnumber){_context2.next=2;break}return _context2.abrupt("return");case 2:if(content=$("#mediabox-content"),playerinfo=$(root.album[itemnumber]).find(".url"),content.empty(),updatenavbarselection(itemnumber),root.currentitemindex=parseInt(itemnumber,10),root.currentitem=root.album[itemnumber],$("#mediabox-content").find("iframe").remove(),url=$(playerinfo).data("value"),width=$(playerinfo).data("width"),height=$(playerinfo).data("height"),player='<div class = "kaltura-player-container"><iframe src="'+url+'" allowfullscreen="true" allow="autoplay *; fullscreen *; encrypted-media *; camera *; microphone *;"  height="100%" width="608" style="height: '+height+"; width: "+width+';"></iframe></div>',$("#mediabox-content").html(player),creator=$(playerinfo).parent().find("#thumbcreator").text(),title=$(playerinfo).parent().find("#thumbtitle").text(),liked=$(playerinfo).data("liked"),totallikes=$(playerinfo).data("totallikes"),commentid=$(playerinfo).data("comment"),commentbox=$("#mediabox-comments"),contextid=$(playerinfo).data("context"),courseid=$(playerinfo).data("course"),$("#creators").text(creator),$("#caption").text("Caption: "+title),$("#liketally").empty(),0==liked?($("#liked").removeClass("fa-heart"),$("#liked").addClass("fa-heart-o"),$("#liketally").text(" Liked by: "+totallikes+" others")):($("#liked").removeClass("fa-heart-o"),$("#liked").addClass("fa-heart"),$("#liketally").text("Liked by: you, "+totallikes+" others")),$("#caption").text("Caption: "+title),!_allowcomments){_context2.next=41;break}return _context2.next=30,fetchcomments($(root.album[itemnumber]).attr("id"),contextid,commentid,courseid);case 30:return data={linktext:"Comments",cid:commentid,contextid:contextid,notoggle:!1,pix:!0,displaytotalcount:!0,count:0,canpost:!0,displaycancel:!0,itemid:$(root.album[itemnumber]).attr("id"),commentarea:"item",component:"mod_kalvidassign",autostart:!0,fullwidth:!1},_context2.next=33,render("mod_kalvidassign/comment_area",data);case 33:template=_context2.sent,$(commentbox).html(template),$(commentbox).find(".comment-ctrl").show(),console.log($(".comment-link a")),console.log($("#mediabox-comments")),console.log($("#mediabox-comments div a")),$(".comment-link").click((function(){$(this).find("i").hasClass("fa-caret-right")?$(this).find("i").addClass("fa-caret-down").removeClass("fa-caret-right"):$(this).find("i").addClass("fa-caret-right").removeClass("fa-caret-down")})),Str.get_strings([{key:"addcomment",component:"moodle"},{key:"comments",component:"moodle"},{key:"commentscount",component:"moodle"},{key:"commentsrequirelogin",component:"moodle"},{key:"deletecommentbyon",component:"moodle"}]).then((function(){Y.use("core_comment",(function(Y){M.core_comment.init(Y,{client_id:data.cid,commentarea:data.commentarea,itemid:data.itemid,area:"item",page:0,courseid:courseid,contextid:data.contextid,component:data.component,notoggle:!1,autostart:!0})}))}));case 41:case"end":return _context2.stop()}}),_callee2)}))),function(_x){return _ref2.apply(this,arguments)}),fetchcomments=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(itemid,contextid,commentid,courseid){var ajaxCall;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:ajaxCall={methodname:"mod_kalvidassign_get_comments",args:{itemid:itemid,contextid:contextid,clientid:commentid,courseid:courseid},fail:notification.exception},ajax.call([ajaxCall])[0].done((function(response){response.result&&($.each(response.comments,(function(key,value){$("#comment-list-"+commentid).append(value.html)})),$("#comment-link-count-"+commentid).text("("+response.count+")"))}));case 4:case"end":return _context3.stop()}}),_callee3)}))),function(_x2,_x3,_x4,_x5){return _ref3.apply(this,arguments)}),enable=function(){return $("body").find(".kalvidassign_videocards").bind("click",(function(e){return e.preventDefault(),start(e.currentTarget),!1}))},repositionitem=function(width,height){var offsetTop,offsetLeft,newwidth="",newheight="",content=$("#mediabox-content"),innercontent=$(".kaltura-player-container"),sidebarwidth=$("#mediabox-sidebar").width();if(root.mediabox.hasClass("sidebarhidden")&&(sidebarwidth=0),void 0!==innercontent){void 0===width&&(width=$(innercontent).find("iframe").width(),height=$(innercontent).find("iframe").height());var winwidth=$("body").width(),winheight=$("body").height(),maxwidth=winwidth-sidebarwidth,maxheight=winheight-vars__navbarheight;width>maxwidth||height>maxheight?(width/maxwidth>height/maxheight?(newwidth=maxwidth,offsetLeft=0,offsetTop=(winheight-(newheight=parseInt(height/(width/maxwidth),10)))/2):(newheight=maxheight,offsetTop=0,offsetLeft=(winwidth-(newwidth=parseInt(width/(height/maxheight),10))-sidebarwidth)/2),newwidth+="px",newheight+="px"):(offsetLeft=(winwidth-width-sidebarwidth)/2,offsetTop=(winheight-height-vars__navbarheight)/2),innercontent.css("width",newwidth),innercontent.css("height",newheight),content.css("top",offsetTop+"px"),content.css("left",offsetLeft+"px")}},resizeoverlay=function(){var viewportwidth=screen.width,viewportheight=screen.height;root.overlay.css("width",viewportwidth),root.overlay.css("height",viewportheight)},start=function(target){$("body").addClass("noscroll mediaboxactive"),root.overlay.css("display","block"),root.mediabox.css("display","block"),url=$(target).find(".url").data("value"),width=$(target).find(".url").data("width"),height=$(target).find(".url").data("height");var player='<div class = "kaltura-player-container"><iframe src="'+url+'" allowfullscreen="true" allow="autoplay *; fullscreen *; encrypted-media *; camera *; microphone *;"  height="100%" width="608" style="height: '+height+"; width: "+width+';"></iframe></div>';$("#mediabox-content").html(player),resizeoverlay(),repositionitem();for(var itemnumber=0,i=0;i<root.album.length;i++)root.album[i].getAttribute("id")===target.getAttribute("id")&&(itemnumber=i);root.currentitemindex!==itemnumber&&$("#mediabox-content").empty(),setfullscreenimg(),changeitem(itemnumber)},setfullscreenimg=function(){if($("#mediabox-sidebar-actions .fullscreen")){var imgurl=M.util.image_url("fullscreen","mod_mediagallery");screenfull.isFullscreen&&(imgurl=M.util.image_url("fullscreenexit","mod_mediagallery")),$("#mediabox-sidebar-actions .fullscreen").attr("src",imgurl)}},stop=function(){screenfull.isFullscreen&&screenfull.exit(),$("body").removeClass("noscroll mediaboxactive"),root.overlay.css("display",""),root.mediabox.css("display","")},render=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(template,data){var renderPromise;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,Templates.render(template,data);case 2:return renderPromise=_context4.sent,_context4.abrupt("return",renderPromise);case 4:case"end":return _context4.stop()}}),_callee4)}))),function(_x6,_x7){return _ref4.apply(this,arguments)});root.construct(allowcomments,allowlikes)};return{init:function(allowcomments,allowlikes){return console.log(allowcomments+allowlikes),new MEDIABOX(allowcomments,allowlikes)}}}));

//# sourceMappingURL=fullscreen.min.js.map